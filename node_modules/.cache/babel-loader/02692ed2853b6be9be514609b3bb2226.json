{"ast":null,"code":"import _classCallCheck from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\my-crypto-zombie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from'react';import ZombiePreview from\"./ZombiePreview\";import'./static/ZombiePreview.css';import MyWeb3 from'./MyWeb3';import moment from\"moment\";import{BrowserRouter as Route,Link}from\"react-router-dom\";import Page from\"./Page\";var Zombiedetail=/*#__PURE__*/function(_Component){_inherits(Zombiedetail,_Component);function Zombiedetail(props){var _this;_classCallCheck(this,Zombiedetail);_this=_possibleConstructorReturn(this,_getPrototypeOf(Zombiedetail).call(this,props));var searchParams=new URLSearchParams(window.location.search);var id=searchParams.get('id');_this.state={id:id,zombie:{},owner:'',zombieFeedTimes:0,myPrice:0,minPrice:0,AttackBtn:function AttackBtn(){return React.createElement(\"div\",null);},RenameArea:function RenameArea(){return React.createElement(\"div\",null);},zombieNewname:'',FeedArea:function FeedArea(){return React.createElement(\"div\",null);},LevelupArea:function LevelupArea(){return React.createElement(\"div\",null);},SaleArea:function SaleArea(){return React.createElement(\"div\",null);},BuyArea:function BuyArea(){return React.createElement(\"div\",null);},onShop:false,shopInfo:{}};_this.zombieChangeName=_this.zombieChangeName.bind(_assertThisInitialized(_this));_this.changeName=_this.changeName.bind(_assertThisInitialized(_this));_this.feed=_this.feed.bind(_assertThisInitialized(_this));_this.levelUp=_this.levelUp.bind(_assertThisInitialized(_this));_this.saleZombie=_this.saleZombie.bind(_assertThisInitialized(_this));_this.buyShopZombie=_this.buyShopZombie.bind(_assertThisInitialized(_this));_this.setPrice=_this.setPrice.bind(_assertThisInitialized(_this));return _this;}_createClass(Zombiedetail,[{key:\"componentDidMount\",value:function componentDidMount(){var that=this;var ethereum=window.ethereum;if(typeof ethereum!=='undefined'||typeof window.web3!=='undefined'){MyWeb3.init().then(function(res){that.getZombie(that.state.id);that.getZombieFeedTimes(that.state.id);that.getMinPrice();that.getZombieShop(that.state.id);});}else{alert('You have to install MetaMask !');}}},{key:\"getZombieShop\",value:function getZombieShop(zombieId){var that=this;MyWeb3.zombieShop(zombieId).then(function(shopInfo){if(shopInfo.price>0){that.setState({onShop:true,shopInfo:shopInfo});}});}},{key:\"getMinPrice\",value:function getMinPrice(){var that=this;MyWeb3.minPrice().then(function(minPrice){if(minPrice>0){MyWeb3.tax().then(function(tax){if(tax>0){that.setState({myPrice:parseFloat(minPrice)+parseFloat(tax),minPrice:parseFloat(minPrice)+parseFloat(tax)});}});}});}},{key:\"getZombieFeedTimes\",value:function getZombieFeedTimes(zombieId){var that=this;MyWeb3.zombieFeedTimes(zombieId).then(function(result){if(result>0){that.setState({zombieFeedTimes:result});}});}},{key:\"setPrice\",value:function setPrice(event){this.setState({myPrice:event.target.value});}},{key:\"zombieChangeName\",value:function zombieChangeName(event){this.setState({zombieNewname:event.target.value});}},{key:\"changeName\",value:function changeName(){var that=this;if(window.defaultAccount!==undefined){MyWeb3.changeName(this.state.id,this.state.zombieNewname).then(function(transactionHash){that.setState({RenameArea:function RenameArea(){return React.createElement(\"div\",null,transactionHash);}});});}}},{key:\"feed\",value:function feed(){var that=this;if(window.defaultAccount!==undefined){MyWeb3.feed(this.state.id).then(function(transactionHash){that.setState({FeedArea:function FeedArea(){return React.createElement(\"div\",null,transactionHash);}});});}}},{key:\"levelUp\",value:function levelUp(){var that=this;if(window.defaultAccount!==undefined){MyWeb3.levelUp(this.state.id).then(function(transactionHash){that.setState({LevelupArea:function LevelupArea(){return React.createElement(\"div\",null,transactionHash);}});});}}},{key:\"saleZombie\",value:function saleZombie(){var that=this;if(window.defaultAccount!==undefined&&this.state.myPrice*this.state.minPrice>0&&this.state.myPrice>=this.state.minPrice){MyWeb3.saleMyZombie(this.state.id,this.state.myPrice).then(function(transactionHash){that.setState({SaleArea:function SaleArea(){return React.createElement(\"div\",null,transactionHash);}});});}}},{key:\"buyShopZombie\",value:function buyShopZombie(){var that=this;if(window.defaultAccount!==undefined){MyWeb3.buyShopZombie(this.state.id,this.state.shopInfo.price).then(function(transactionHash){that.setState({BuyArea:function BuyArea(){return React.createElement(\"div\",null,transactionHash);}});});}}},{key:\"getZombie\",value:function getZombie(zombieId){var that=this;MyWeb3.zombies(zombieId).then(function(result){that.setState({zombie:result});that.setState({zombieNewname:result.name});MyWeb3.zombieToOwner(zombieId).then(function(zombieOwner){that.setState({owner:zombieOwner});if(window.defaultAccount!==undefined&&zombieOwner!==window.defaultAccount){that.setState({AttackBtn:function AttackBtn(){return React.createElement(\"button\",{className:\"attack-btn\"},React.createElement(\"span\",null,React.createElement(Link,{to:\"?ZombieAttack&id=\"+that.state.id},\"Challenge\")));}});if(that.state.onShop){that.setState({BuyArea:function BuyArea(){return React.createElement(\"div\",null,React.createElement(\"div\",{className:\"zombieInput\"},\"Price\\uFF1A\",that.state.shopInfo.price,\" ether\"),React.createElement(\"div\",null,React.createElement(\"button\",{className:\"pay-btn pay-btn-last\",onClick:that.buyShopZombie},React.createElement(\"span\",null,\"Buy\"))));}});}}else{that.setState({AttackBtn:function AttackBtn(){return React.createElement(\"div\",null);}});if(that.state.zombie.level>1){that.setState({RenameArea:function RenameArea(){return React.createElement(\"div\",null,React.createElement(\"div\",{className:\"zombieInput\"},React.createElement(\"input\",{type:\"text\",id:\"zombieName\",placeholder:that.state.zombie.name,value:that.state.zombieNewname,onChange:that.zombieChangeName})),React.createElement(\"div\",null,React.createElement(\"button\",{className:\"pay-btn pay-btn-last\",onClick:that.changeName},React.createElement(\"span\",null,\"Change Name\"))));}});}if(that.state.zombie.readyTime===0||moment().format('X')>that.state.zombie.readyTime){that.setState({FeedArea:function FeedArea(){return React.createElement(\"div\",null,React.createElement(\"button\",{className:\"pay-btn\",onClick:that.feed},React.createElement(\"span\",null,\"Feed\")));}});}that.setState({LevelupArea:function LevelupArea(){return React.createElement(\"div\",null,React.createElement(\"button\",{className:\"pay-btn\",onClick:that.levelUp},React.createElement(\"span\",null,\"Upgrade\")));}});if(!that.state.onShop){that.setState({SaleArea:function SaleArea(){return React.createElement(\"div\",null,React.createElement(\"div\",{className:\"zombieInput\"},React.createElement(\"input\",{type:\"text\",id:\"salePrice\",placeholder:that.state.minPrice,value:that.state.myPrice,onChange:that.setPrice})),React.createElement(\"div\",null,React.createElement(\"button\",{className:\"pay-btn pay-btn-last\",onClick:that.saleZombie},React.createElement(\"span\",null,\"Sell\"))));}});}}});});}},{key:\"render\",value:function render(){var readyTime='已冷却';if(this.state.zombie.readyTime!==undefined&&moment().format('X')<this.state.zombie.readyTime){readyTime=moment(parseInt(this.state.zombie.readyTime)*1000).format('YYYY-MM-DD');}var AttackBtn=this.state.AttackBtn;var RenameArea=this.state.RenameArea;var FeedArea=this.state.FeedArea;var LevelupArea=this.state.LevelupArea;var SaleArea=this.state.SaleArea;var BuyArea=this.state.BuyArea;return React.createElement(\"div\",{className:\"App\"},React.createElement(\"div\",{className:\"row zombie-parts-bin-component\",authenticated:\"true\",lesson:\"1\",lessonidx:\"1\"},React.createElement(\"div\",{className:\"zombie-preview\",id:\"zombie-preview\"},React.createElement(\"div\",{className:\"zombie-char\"},React.createElement(\"div\",{className:\"zombie-loading zombie-parts\",style:{display:\"none\"}}),React.createElement(ZombiePreview,{zombie:this.state.zombie}),React.createElement(\"div\",{className:\"hide\"},React.createElement(\"div\",{className:\"card-header bg-dark hide-overflow-text\"},React.createElement(\"strong\",null)),React.createElement(\"small\",{className:\"hide-overflow-text\"},\"CryptoZombie\\u7B2C\\u4E00\\u7EA7\")))),React.createElement(\"div\",{className:\"zombie-detail\"},React.createElement(\"dl\",null,React.createElement(\"dt\",null,this.state.zombie.name),React.createElement(\"dt\",null,\"\\u4E3B\\u4EBA\"),React.createElement(\"dd\",null,this.state.owner),React.createElement(\"dt\",null,\"\\u7B49\\u7EA7\"),React.createElement(\"dd\",null,this.state.zombie.level),React.createElement(\"dt\",null,\"\\u80DC\\u5229\\u6B21\\u6570\"),React.createElement(\"dd\",null,this.state.zombie.winCount),React.createElement(\"dt\",null,\"\\u5931\\u8D25\\u6B21\\u6570\"),React.createElement(\"dd\",null,this.state.zombie.lossCount),React.createElement(\"dt\",null,\"\\u51B7\\u5374\\u65F6\\u95F4\"),React.createElement(\"dd\",null,readyTime),React.createElement(\"dt\",null,\"\\u5582\\u98DF\\u6B21\\u6570\"),React.createElement(\"dd\",null,this.state.zombieFeedTimes),React.createElement(\"dt\",null),React.createElement(\"dd\",null,React.createElement(AttackBtn,null),React.createElement(RenameArea,null),React.createElement(FeedArea,null),React.createElement(LevelupArea,null),React.createElement(SaleArea,null),React.createElement(BuyArea,null)))),React.createElement(Route,{path:\"*\",component:Page})));}}]);return Zombiedetail;}(Component);export default Zombiedetail;","map":{"version":3,"sources":["C:/my-crypto-zombie/src/ZombieDetail.js"],"names":["React","Component","ZombiePreview","MyWeb3","moment","BrowserRouter","Route","Link","Page","Zombiedetail","props","searchParams","URLSearchParams","window","location","search","id","get","state","zombie","owner","zombieFeedTimes","myPrice","minPrice","AttackBtn","RenameArea","zombieNewname","FeedArea","LevelupArea","SaleArea","BuyArea","onShop","shopInfo","zombieChangeName","bind","changeName","feed","levelUp","saleZombie","buyShopZombie","setPrice","that","ethereum","web3","init","then","res","getZombie","getZombieFeedTimes","getMinPrice","getZombieShop","alert","zombieId","zombieShop","price","setState","tax","parseFloat","result","event","target","value","defaultAccount","undefined","transactionHash","saleMyZombie","zombies","name","zombieToOwner","zombieOwner","level","readyTime","format","parseInt","display","winCount","lossCount"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport ZombiePreview from \"./ZombiePreview\"\r\nimport './static/ZombiePreview.css'\r\nimport MyWeb3 from './MyWeb3'\r\nimport moment from \"moment\"\r\nimport {\r\n    BrowserRouter as \r\n    Route,\r\n    Link\r\n  } from \"react-router-dom\"\r\n  import Page from \"./Page\";\r\n\r\nclass Zombiedetail extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        const searchParams = new URLSearchParams(window.location.search)\r\n        \r\n        const id = searchParams.get('id')   \r\n        this.state = {\r\n            id:id ,\r\n            zombie:{},owner:'',\r\n            zombieFeedTimes:0,\r\n            myPrice:0,\r\n            minPrice:0,\r\n            AttackBtn: () =>{return(<div></div>)}, \r\n            RenameArea: () =>{return(<div></div>)},\r\n            zombieNewname:'',\r\n            FeedArea: () =>{return(<div></div>)},\r\n            LevelupArea: () =>{return(<div></div>)},\r\n            SaleArea: () =>{return(<div></div>)},\r\n            BuyArea: () =>{return(<div></div>)},\r\n            onShop:false,\r\n            shopInfo:{}\r\n        }\r\n        this.zombieChangeName = this.zombieChangeName.bind(this)\r\n        this.changeName = this.changeName.bind(this)\r\n        this.feed = this.feed.bind(this)\r\n        this.levelUp = this.levelUp.bind(this)\r\n        this.saleZombie = this.saleZombie.bind(this)\r\n        this.buyShopZombie = this.buyShopZombie.bind(this)\r\n        this.setPrice = this.setPrice.bind(this)\r\n    }\r\n     \r\n    componentDidMount(){\r\n        let that = this\r\n        let ethereum = window.ethereum\r\n        if (typeof  ethereum !== 'undefined' || (typeof window.web3 !== 'undefined')) {\r\n            MyWeb3.init().then(function(res){\r\n                that.getZombie(that.state.id)\r\n                that.getZombieFeedTimes(that.state.id)\r\n                that.getMinPrice()\r\n                that.getZombieShop(that.state.id)\r\n            })\r\n        }else {\r\n            alert('You have to install MetaMask !')\r\n        }\r\n    }\r\n    getZombieShop(zombieId){\r\n        let that = this\r\n        MyWeb3.zombieShop(zombieId).then(function (shopInfo) {\r\n            if(shopInfo.price>0){\r\n                that.setState({onShop:true,shopInfo:shopInfo})\r\n            }\r\n        })\r\n    }\r\n    getMinPrice(){\r\n        let that = this\r\n        MyWeb3.minPrice().then(function (minPrice) {\r\n            if(minPrice>0){\r\n                MyWeb3.tax().then(function (tax) {\r\n                    if(tax>0){\r\n                        that.setState({myPrice:parseFloat(minPrice)+parseFloat(tax),minPrice:parseFloat(minPrice)+parseFloat(tax)})\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }\r\n    getZombieFeedTimes(zombieId){\r\n        let that = this\r\n        MyWeb3.zombieFeedTimes(zombieId).then(function (result) {\r\n            if(result>0){\r\n                that.setState({zombieFeedTimes:result})\r\n            }\r\n        })\r\n    }\r\n    setPrice(event){\r\n        this.setState({\r\n            myPrice:event.target.value\r\n        })\r\n    }\r\n    zombieChangeName(event){\r\n        this.setState({\r\n            zombieNewname:event.target.value\r\n        })\r\n    }\r\n    changeName(){\r\n        let that = this\r\n        if(window.defaultAccount !== undefined){\r\n            MyWeb3.changeName(this.state.id,this.state.zombieNewname)\r\n            .then(function(transactionHash){\r\n                that.setState({RenameArea : () =>{\r\n                    return(<div>{transactionHash}</div>)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n    feed(){\r\n        let that = this\r\n        if(window.defaultAccount !== undefined){\r\n            MyWeb3.feed(this.state.id)\r\n            .then(function(transactionHash){\r\n                that.setState({FeedArea : () =>{\r\n                    return(<div>{transactionHash}</div>)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n    levelUp(){\r\n        let that = this\r\n        if(window.defaultAccount !== undefined){\r\n            MyWeb3.levelUp(this.state.id)\r\n            .then(function(transactionHash){\r\n                that.setState({LevelupArea : () =>{\r\n                    return(<div>{transactionHash}</div>)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n    saleZombie(){\r\n        let that = this\r\n        if(window.defaultAccount !== undefined \r\n            && this.state.myPrice*this.state.minPrice>0 \r\n            && this.state.myPrice>=this.state.minPrice){\r\n            MyWeb3.saleMyZombie(this.state.id,this.state.myPrice)\r\n            .then(function(transactionHash){\r\n                that.setState({SaleArea : () =>{\r\n                    return(<div>{transactionHash}</div>)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n    buyShopZombie(){\r\n        let that = this\r\n        if(window.defaultAccount !== undefined){\r\n            MyWeb3.buyShopZombie(this.state.id,this.state.shopInfo.price)\r\n            .then(function(transactionHash){\r\n                that.setState({BuyArea : () =>{\r\n                    return(<div>{transactionHash}</div>)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n    getZombie(zombieId){\r\n        let that = this\r\n        MyWeb3.zombies(zombieId).then(function (result) {\r\n            that.setState({zombie:result})\r\n            that.setState({zombieNewname:result.name})\r\n            MyWeb3.zombieToOwner(zombieId).then(function (zombieOwner) {\r\n                that.setState({owner:zombieOwner})\r\n                if(window.defaultAccount !== undefined &&\r\n                    zombieOwner !== window.defaultAccount){\r\n                    that.setState({AttackBtn : () =>{\r\n                        return(\r\n                        <button className=\"attack-btn\">\r\n                            <span>\r\n                                <Link to={`?ZombieAttack&id=`+that.state.id} >Challenge</Link>\r\n                            </span>\r\n                        </button>)\r\n                        }\r\n                    })\r\n                    if(that.state.onShop){\r\n                        that.setState({BuyArea : () =>{\r\n                            return(\r\n                                <div>\r\n                                    <div className='zombieInput'>\r\n                                        Price：{that.state.shopInfo.price} ether\r\n                                    </div>\r\n                                    <div>\r\n                                        <button className=\"pay-btn pay-btn-last\" onClick={that.buyShopZombie}>\r\n                                            <span>\r\n                                                Buy\r\n                                            </span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                                )\r\n                            }\r\n                        })\r\n                    }\r\n                }else{\r\n                    that.setState({AttackBtn : () =>{return(<div></div>)}})\r\n                    if(that.state.zombie.level > 1){\r\n                        that.setState({RenameArea : () =>{\r\n                            return(\r\n                                <div>\r\n                                    <div className='zombieInput'>\r\n                                        <input \r\n                                            type=\"text\" \r\n                                            id='zombieName' \r\n                                            placeholder={that.state.zombie.name} \r\n                                            value={that.state.zombieNewname}\r\n                                            onChange={that.zombieChangeName}>\r\n                                        </input>\r\n                                    </div>\r\n                                    <div>\r\n                                        <button className=\"pay-btn pay-btn-last\" onClick={that.changeName}>\r\n                                            <span>\r\n                                                Change Name\r\n                                            </span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>)\r\n                            }\r\n                        })\r\n                    }\r\n                    if(that.state.zombie.readyTime === 0 || moment().format('X')>that.state.zombie.readyTime){\r\n                        that.setState({FeedArea : () =>{\r\n                            return(\r\n                                <div>\r\n                                    <button className=\"pay-btn\" onClick={that.feed}>\r\n                                        <span>\r\n                                            Feed\r\n                                        </span>\r\n                                    </button>\r\n                                </div>)\r\n                            }\r\n                        })\r\n                    }\r\n                    that.setState({LevelupArea : () =>{\r\n                        return(\r\n                            <div>\r\n                                <button className=\"pay-btn\" onClick={that.levelUp}>\r\n                                    <span>\r\n                                        Upgrade\r\n                                    </span>\r\n                                </button>\r\n                            </div>)\r\n                        }\r\n                    })\r\n                    if(!that.state.onShop){\r\n                        that.setState({SaleArea : () =>{\r\n                            return(\r\n                                <div>\r\n                                    <div className='zombieInput'>\r\n                                        <input \r\n                                            type=\"text\" \r\n                                            id='salePrice' \r\n                                            placeholder={that.state.minPrice} \r\n                                            value={that.state.myPrice}\r\n                                            onChange={that.setPrice}>\r\n                                        </input>\r\n                                    </div>\r\n                                    <div>\r\n                                        <button className=\"pay-btn pay-btn-last\" onClick={that.saleZombie}>\r\n                                            <span>\r\n                                                Sell\r\n                                            </span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                                )\r\n                            }\r\n                        })\r\n                    }\r\n                } \r\n            })\r\n        })\r\n    }\r\n\r\n    render() { \r\n        var readyTime = '已冷却'                                \r\n        if(this.state.zombie.readyTime !== undefined && moment().format('X')<this.state.zombie.readyTime){\r\n            readyTime = moment(parseInt(this.state.zombie.readyTime)*1000).format('YYYY-MM-DD')\r\n        }\r\n        var AttackBtn = this.state.AttackBtn\r\n        var RenameArea = this.state.RenameArea\r\n        var FeedArea = this.state.FeedArea\r\n        var LevelupArea = this.state.LevelupArea\r\n        var SaleArea = this.state.SaleArea\r\n        var BuyArea = this.state.BuyArea\r\n        return ( \r\n            <div className=\"App\">\r\n                <div  className=\"row zombie-parts-bin-component\" authenticated=\"true\" lesson=\"1\" lessonidx=\"1\">\r\n                    <div  className=\"zombie-preview\" id=\"zombie-preview\">\r\n                        <div className=\"zombie-char\">\r\n                            <div className=\"zombie-loading zombie-parts\" style={{display:\"none\"}}></div>\r\n                                <ZombiePreview zombie={this.state.zombie}></ZombiePreview>\r\n                            <div className=\"hide\">\r\n                                <div className=\"card-header bg-dark hide-overflow-text\">\r\n                                    <strong ></strong></div>\r\n                                <small className=\"hide-overflow-text\">CryptoZombie第一级</small>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"zombie-detail\">\r\n                        <dl>\r\n                            <dt>{this.state.zombie.name}</dt>\r\n                            <dt>主人</dt>\r\n                            <dd>{this.state.owner}</dd>\r\n                            <dt>等级</dt>\r\n                            <dd>{this.state.zombie.level}</dd>\r\n                            <dt>胜利次数</dt>\r\n                            <dd>{this.state.zombie.winCount}</dd>\r\n                            <dt>失败次数</dt>\r\n                            <dd>{this.state.zombie.lossCount}</dd>\r\n                            <dt>冷却时间</dt>\r\n                            <dd>{readyTime}</dd>\r\n                            <dt>喂食次数</dt>\r\n                            <dd>{this.state.zombieFeedTimes}</dd>\r\n                            <dt></dt>\r\n                            <dd>\r\n                                <AttackBtn></AttackBtn>\r\n                                <RenameArea></RenameArea>\r\n                                <FeedArea></FeedArea>\r\n                                <LevelupArea></LevelupArea>\r\n                                <SaleArea></SaleArea>\r\n                                <BuyArea></BuyArea>\r\n                            </dd>\r\n                        </dl>\r\n                    </div>\r\n                    <Route path=\"*\" component={Page}></Route>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Zombiedetail;"]},"metadata":{},"sourceType":"module"}